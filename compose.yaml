services:
  traefik:
    image: traefik:v3.6@sha256:90099f8948c828ecf0ababd711a4359a2443eba12261c1df2f548a3b1d815938
    ports:
      - "443:443"
      - "8080:8080"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - ./.docker/traefik/traefik.yaml:/etc/traefik/traefik.yaml:ro
      - ./.docker/traefik/dynamic.yaml:/etc/traefik/dynamic.yaml:ro
      - ./.docker/traefik/certs:/etc/traefik/certs:ro
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.dashboard.rule=Host(`traefik.slides.localhost`)"
      - "traefik.http.routers.dashboard.service=api@internal"
      - "traefik.http.routers.dashboard.tls=true"

  paiza-theme:
    build: .
    tty: true
    stdin_open: true
    profiles:
      - paiza-theme
    volumes:
      - .:/app
      - node_modules:/app/node_modules
    command: >
      sh -c "pnpm install && cd themes/paiza && pnpm exec slidev example.md --remote --port 3030"
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.paiza-theme.rule=Host(`paiza-theme.slides.localhost`)"
      - "traefik.http.routers.paiza-theme.tls=true"
      - "traefik.http.services.paiza-theme.loadbalancer.server.port=3030"

  academic-theme:
    build: .
    tty: true
    stdin_open: true
    profiles:
      - academic-theme
    volumes:
      - .:/app
      - node_modules:/app/node_modules
    command: >
      sh -c "pnpm install && cd themes/academic && pnpm exec slidev example.md --remote --port 3030"
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.academic-theme.rule=Host(`academic-theme.slides.localhost`)"
      - "traefik.http.routers.academic-theme.tls=true"
      - "traefik.http.services.academic-theme.loadbalancer.server.port=3030"

  lt-devin:
    build: .
    tty: true
    stdin_open: true
    profiles:
      - lt-devin
    volumes:
      - .:/app
      - node_modules:/app/node_modules
    command: >
      sh -c "pnpm install && cd decks/202602-lt-devin-wiki-mcp && pnpm exec slidev slides.md --remote --port 3030"
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.lt-devin.rule=Host(`lt-devin.slides.localhost`)"
      - "traefik.http.routers.lt-devin.tls=true"
      - "traefik.http.services.lt-devin.loadbalancer.server.port=3030"

  dev:
    build: .
    profiles:
      - dev
    volumes:
      - .:/app
      - node_modules:/app/node_modules
    command: >
      sh -c "pnpm install && sleep infinity"

volumes:
  node_modules:
